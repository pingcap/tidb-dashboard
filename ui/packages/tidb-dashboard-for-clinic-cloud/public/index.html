<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="./distro-res/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      http-equiv="Cache-control"
      content="no-cache, no-store, must-revalidate"
    />
    <style>
      body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
          Oxygen, Ubuntu, Cantarell, 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
          sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        background: #fff;
      }

      #dashboard_page_spinner {
        position: absolute;
        top: 50%;
        left: 50%;
      }

      #dashboard_page_spinner p {
        margin-left: -50%;
        margin-top: 8px;
        color: #888;
      }

      .dot-flashing {
        position: relative;
        width: 10px;
        height: 10px;
        border-radius: 5px;
        background-color: #aaa;
        -webkit-animation: dot-flashing 1s infinite linear alternate;
        animation: dot-flashing 1s infinite linear alternate;
        -webkit-animation-delay: 0.5s;
        animation-delay: 0.5s;
      }

      .dot-flashing::before,
      .dot-flashing::after {
        content: '';
        display: inline-block;
        position: absolute;
        top: 0;
      }

      .dot-flashing::before {
        left: -15px;
        width: 10px;
        height: 10px;
        border-radius: 5px;
        background-color: #aaa;
        -webkit-animation: dot-flashing 1s infinite alternate;
        animation: dot-flashing 1s infinite alternate;
        -webkit-animation-delay: 0s;
        animation-delay: 0s;
      }

      .dot-flashing::after {
        left: 15px;
        width: 10px;
        height: 10px;
        border-radius: 5px;
        background-color: #aaa;
        -webkit-animation: dot-flashing 1s infinite alternate;
        animation: dot-flashing 1s infinite alternate;
        -webkit-animation-delay: 1s;
        animation-delay: 1s;
      }

      @-webkit-keyframes dot-flashing {
        0% {
          background-color: #aaa;
        }
        50%,
        100% {
          background-color: #ddd;
        }
      }

      @keyframes dot-flashing {
        0% {
          background-color: #aaa;
        }
        50%,
        100% {
          background-color: #ddd;
        }
      }
    </style>
    <link rel="stylesheet" href="./dashboardApp.css?t=%TIME_PLACE_HOLDER%" />
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>

    <div id="dashboard_page_spinner">
      <div class="dot-flashing"></div>
      <p>
        It may take a bit long time to load for the first time, due to download
        some js files.
      </p>
    </div>
    <div id="root"></div>

    <script type="module">
      import startDashboard from './dashboardApp.js?t=%TIME_PLACE_HOLDER%'

      const apiToken = localStorage.getItem('clinic.auth.csrf_token')

      // example entry link:
      // http://localhost:8181/clinic/dashboard/cloud/?orgId=1&clusterId=63405#/overview
      const searchParams = new URLSearchParams(window.location.search)
      const orgId = searchParams.get('orgId') || ''
      const clusterId = searchParams.get('clusterId') || ''
      if (apiToken === '' || orgId === '' || clusterId === '') {
        window.alert('Invalid token, orgId or clusterId!')
        window.location.assign('/')
      }

      const apiPathBase = `/clinic/api/v1/dashboard/proxy/orgs/${orgId}/clusters/${clusterId}/pd/dashboard/api`
      startDashboard({
        clientOptions: {
          apiPathBase,
          apiToken
        },
        clusterInfo: {
          orgId,
          clusterId
        },

        appsConfig: {
          overview: {
            showMetrics: false
          }
        },
        appsDisabled: [
          'topsql',
          'slow_query',
          'conprof',
          'query_editor',
          'diagnose',
          'monitoring',
          'search_logs',
          'system_report',
          'resource_manager'
        ]
      })
    </script>
  </body>
</html>
